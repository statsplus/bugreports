name: Issue Compatibility Check

on:
  issues:
    types: [opened, edited]

jobs:
  check-compatibility:
    runs-on: ubuntu-latest

    permissions:
      issues: write

    steps:
      - name: Check compatibility checkboxes
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.issue.body || "";

            const requiredChecks = [
              "Using Fabric Loader",
              "No other server-side mods installed",
              "Client-side mods only",
              "Using latest STATS+ version"
            ];

            const missing = requiredChecks.filter(check => {
              const regex = new RegExp(`- \\[[xX]\\]\\s*${check}`, "i");
              return !regex.test(body);
            });

            if (missing.length > 0) {
              const message = `
âŒ **Compatibility Check Failed**

The following required checks were not confirmed:

${missing.map(m => `- ${m}`).join("\n")}

Please edit your issue and check all required boxes before continuing.
`;

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: message
              });
            }
